package com.example.cryptoshop_backend.controllers;

import com.example.cryptoshop_backend.models.User;
import com.example.cryptoshop_backend.repositories.UserRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.*;

import static com.example.cryptoshop_backend.utils.LoginValidators.isEmailValid;

public class UserController {
    //@CrossOrigin(origins = "http://localhost:3000")
    @Autowired
    // This means to get the bean called userRepository. Which is auto-generated by Spring, we will use it to handle the data
    private UserRepository userRepository;

    @PostMapping(path = "/signUp")
    User addNewUser(@RequestBody User newUser) {
        userRepository.save(newUser);
        return newUser;
    }

    @GetMapping(path = "/allUsers")
    public @ResponseBody
    Iterable<User> getAllUsers() {
        // This returns a JSON or XML with the users
        return userRepository.findAll();
    }

    @PostMapping(path = "/login")
    public ResponseEntity<String> userLogin(@RequestParam String emailOrUserName, @RequestParam String hashedPass) {
        User user;
        if (isEmailValid(emailOrUserName))
            user = userRepository.findByEmail(emailOrUserName);
        else
            user = userRepository.findByUsername(emailOrUserName);

        if (user == null || !hashedPass.equals(user.getHashed_pass()))
            return ResponseEntity.badRequest().body("Incorrect password or user not found :(");
        else
            return ResponseEntity.ok("Login succesfull");
    }
}

